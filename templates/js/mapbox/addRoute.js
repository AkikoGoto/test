/**
 * エジソン版限定
 * テスト的にルートと、その周り半径100メートルにポリゴンを作る
 * @author Akiko Goto
 * @since 2017/03/14
 * @version 2.1
 * @returns
 */

//テストデータ
/*var route = [[	139.66	,	35.4878	]	,
	[	139.66	,	35.4877	]	,
	[	139.658	,	35.4865	]	,
	[	139.656	,	35.4858	]	,
	[	139.654	,	35.4852	]	,
	[	139.652	,	35.4845	]	,
	[	139.65	,	35.4838	]	,
	[	139.647	,	35.4831	]	,
	[	139.645	,	35.4824	]	,
	[	139.643	,	35.4814	]	,
	[	139.642	,	35.4802	]	,
	[	139.64	,	35.479	]	,
	[	139.639	,	35.4775	]	,
	[	139.637	,	35.476	]	,
	[	139.635	,	35.4752	]	,
	[	139.634	,	35.4737	]	,
	[	139.632	,	35.4723	]	,
	[	139.629	,	35.4696	]	,
	[	139.627	,	35.4689	]	,
	[	139.627	,	35.4689	]	,
	[	139.625	,	35.4679	]	,
	[	139.623	,	35.4678	]	,
	[	139.621	,	35.468	]	,
	[	139.619	,	35.4682	]	,
	[	139.619	,	35.4682	]	,
	[	139.616	,	35.4685	]	,
	[	139.615	,	35.4693	]	,
	[	139.611	,	35.4711	]	,
	[	139.609	,	35.4709	]	,
	[	139.606	,	35.4708	]	,
	[	139.605	,	35.472	]	,
	[	139.603	,	35.473	]	,
	[	139.603	,	35.4747	]	,
	[	139.602	,	35.4762	]	,
	[	139.6	,	35.4749	]	,
	[	139.599	,	35.4735	]	,
	[	139.597	,	35.472	]	,
	[	139.595	,	35.4716	]	,
];


var route2 = [[	139.606	,	35.4459	]	,
[	139.606	,	35.4459	]	,
[	139.607	,	35.447	]	,
[	139.609	,	35.4477	]	,
[	139.611	,	35.4489	]	,
[	139.61	,	35.4506	]	,
[	139.609	,	35.4517	]	,
[	139.61	,	35.453	]	,
[	139.612	,	35.4538	]	,
[	139.614	,	35.4548	]	,
[	139.616	,	35.4557	]	,
[	139.617	,	35.4566	]	,
[	139.62	,	35.4574	]	,
[	139.622	,	35.4581	]	,
[	139.623	,	35.4592	]	,
[	139.624	,	35.461	]	,
[	139.624	,	35.463	]	,
[	139.624	,	35.4648	]	,
[	139.624	,	35.4648	]	,
[	139.625	,	35.4664	]	,
[	139.626	,	35.468	]	,
[	139.626	,	35.468	]	,
[	139.627	,	35.4696	]	,
[	139.627	,	35.4696	]	,
[	139.626	,	35.471	]	,
[	139.626	,	35.471	]	,
[	139.628	,	35.4725	]	,
[	139.629	,	35.4739	]	,
[	139.63	,	35.4754	]	,
[	139.632	,	35.4769	]	,
[	139.633	,	35.4784	]	,
[	139.632	,	35.4799	]	,
[	139.631	,	35.4814	]	,
[	139.63	,	35.4829	]	,
[	139.628	,	35.4843	]	,
[	139.628	,	35.4857	]	,
[	139.628	,	35.4875	]	,
[	139.628	,	35.4891	]	,
[	139.629	,	35.4907	]	,
[	139.63	,	35.4918	]	,
[	139.628	,	35.4906	]	,
[	139.627	,	35.491	]	,
];


var route3 = [[	139.646	,	35.4402	]	,
	[	139.644	,	35.4397	]	,
	[	139.642	,	35.4406	]	,
	[	139.64	,	35.4416	]	,
	[	139.638	,	35.4428	]	,
	[	139.636	,	35.4438	]	,
	[	139.634	,	35.4453	]	,
	[	139.633	,	35.4469	]	,
	[	139.632	,	35.4486	]	,
	[	139.633	,	35.4504	]	,
	[	139.632	,	35.4521	]	,
	[	139.63	,	35.4533	]	,
	[	139.628	,	35.4547	]	,
	[	139.627	,	35.4563	]	,
	[	139.628	,	35.4575	]	,
	[	139.627	,	35.4592	]	,
	[	139.627	,	35.4611	]	,
	[	139.627	,	35.4629	]	,
	[	139.627	,	35.4648	]	,
	[	139.628	,	35.4666	]	,
	[	139.629	,	35.4684	]	,
	[	139.63	,	35.4699	]	,
	[	139.632	,	35.4713	]	,
	[	139.633	,	35.4728	]	,
	[	139.634	,	35.4744	]	,
	[	139.636	,	35.4757	]	,
	[	139.638	,	35.4761	]	,
	[	139.639	,	35.4776	]	,
	[	139.64	,	35.4792	]	,
	[	139.642	,	35.4804	]	,
	[	139.644	,	35.4815	]	,
	[	139.646	,	35.4824	]	,
	[	139.648	,	35.4831	]	,
	[	139.65	,	35.4837	]	,
	[	139.652	,	35.4846	]	,
	[	139.654	,	35.4852	]	,
	[	139.656	,	35.4859	]	,
	[	139.658	,	35.4865	]	,
	[	139.66	,	35.4878	]	,
	[	139.662	,	35.4888	]	,
	[	139.664	,	35.4889	]	,
	[	139.667	,	35.4896	]	,
	[	139.669	,	35.4904	]	,
	[	139.671	,	35.491	]	,
	[	139.67	,	35.4908	]	,
	[	139.672	,	35.4917	]	,
	[	139.674	,	35.4926	]	,
];
*/

function addRoutes(routes) {

	for (var i = 0; i < routes.length; i++){
	
		//2番目の引数は輸送ルートのポリゴンに一意の名前をつけないといけないので
		addRouteAndPopup(routes[i] , "transport_route" + i, routes[i].name);

	}
}

/**
 * ルートのポリゴンと、ルート名称のポップアップを表示
 * @param route
 * @param route_id
 * @param route_name
 * @param color
 * @returns
 */
function addRouteAndPopup(route, route_id, route_name, color = null) {
	
	var hundredMeterOut = turf.buffer(route.geo_json, 100, 'meters');
	hundredMeterOut.features[0].properties.name = route_name;

	if(color == null){
		color = randomColor({luminosity: 'bright'}); 
	}
	
	addPolygon(hundredMeterOut.features, route_id, color, color);
	
	makeMapboxPopup(route_id);

}

function getDatasets(){
	
	//エジソンテスト用ライン
	var dataset_id = "cj091xf6d001z2wowvpmi8qf9";
	
    var url ="https://api.mapbox.com/datasets/v1/onlineconsultant/" + dataset_id + "?access_token=" + mapboxgl.accessToken;
console.log(url);    
    var xmlhttp = new XMLHttpRequest();	
	
    xmlhttp.onreadystatechange = function() {
		    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
		    	
		        var result = JSON.parse(xmlhttp.responseText);
console.log(result);
		    
		    }else{
		    	
		    	$("#result").text("指定のデータは存在しません");
		    }
	
		}
	
	xmlhttp.open("GET", url, true);
	xmlhttp.send();
     
	
}